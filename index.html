<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙŠØ§Ù‚ØªÙŠ â€“ Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù„ÙŠØ§Ù‚Ø©</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #3b82f6;
      --success: #10b981;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #0f172a;
      --bg: #f1f5f8;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: var(--bg);
      color: var(--dark);
      padding-top: 60px;
    }
    /* ========== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ ========== */
    .top-nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 0 15px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-around;
      z-index: 1000;
    }
    .nav-icon {
      font-size: 1.4rem;
      color: #64748b;
      cursor: pointer;
      transition: color 0.2s;
    }
    .nav-icon.active, .nav-icon:hover {
      color: var(--primary);
    }
    /* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ========== */
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .section {
      background: white;
      padding: 22px;
      border-radius: 18px;
      margin-bottom: 22px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }
    .hidden { display: none; }
    h2 {
      font-size: 22px;
      margin-bottom: 20px;
      color: var(--primary);
      text-align: center;
    }
    .metric-box {
      text-align: center;
      margin: 15px 0;
    }
    .metric-label {
      font-size: 15px;
      color: #64748b;
      margin-bottom: 5px;
    }
    .metric-value {
      font-size: 28px;
      font-weight: bold;
      color: var(--primary);
    }
    .coord {
      font-family: monospace;
      background: #f1f5f8;
      padding: 8px;
      border-radius: 8px;
      margin: 8px 0;
      direction: ltr;
      text-align: center;
      font-size: 14px;
    }
    #mode {
      padding: 6px;
      border-radius: 6px;
      margin: 10px 0;
      font-weight: bold;
      background: #dbeafe;
      color: #1d4ed8;
      text-align: center;
    }
    .btn {
      width: 100%;
      padding: 12px;
      font-size: 17px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      margin: 10px 0;
    }
    .btn-start { background: var(--success); color: white; }
    .btn-stop { background: var(--danger); color: white; }
    .btn:disabled { opacity: 0.6; }
    /* ========== Ø§Ù„ØªØºØ°ÙŠØ© ========== */
    .input-group {
      margin: 12px 0;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #334155;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 16px;
    }
    /* ========== Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ========== */
    .profile-info {
      background: #f1f5f8;
      padding: 15px;
      border-radius: 12px;
      margin: 15px 0;
    }
  </style>
</head>
<body>

  <!-- ========== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ ========== -->
  <nav class="top-nav">
    <i class="nav-icon fas fa-home active" data-tab="dashboard"></i>
    <i class="nav-icon fas fa-dumbbell" data-tab="workouts"></i>
    <i class="nav-icon fas fa-utensils" data-tab="nutrition"></i>
    <i class="nav-icon fas fa-user" data-tab="profile"></i>
  </nav>

  <div class="container">
    <!-- ========== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== -->
    <div id="dashboardTab" class="tab-content">
      <div class="section">
        <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©</h2>
        <div class="metric-box">
          <div class="metric-label">Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="metric-value" id="dashSteps">0</div>
        </div>
        <div class="metric-box">
          <div class="metric-label">Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
          <div class="metric-value" id="dashDistance">0.00 Ù…</div>
        </div>
        <div class="metric-box">
          <div class="metric-label">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø­Ø±ÙˆÙ‚Ø©</div>
          <div class="metric-value" id="dashCalories">0</div>
        </div>
        <div class="metric-box">
          <div class="metric-label">Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©</div>
          <div class="metric-value" id="dashConsumed">0</div>
        </div>
      </div>
    </div>

    <!-- ========== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† ========== -->
    <div id="workoutsTab" class="tab-content hidden">
      <div class="section">
        <h2>ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ù„ÙŠØ§Ù‚Ø©</h2>
        <div class="metric-box">
          <div class="metric-label">Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
          <div class="metric-value" id="workoutDistance">0.00 Ù…</div>
        </div>
        <div class="metric-box">
          <div class="metric-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª</div>
          <div class="metric-value" id="workoutSteps">0</div>
        </div>
        <div id="mode">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
        <div class="coord" id="workoutLat">Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: â€”</div>
        <div class="coord" id="workoutLng">Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: â€”</div>
        <button id="startWorkoutBtn" class="btn btn-start">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</button>
        <button id="stopWorkoutBtn" class="btn btn-stop" disabled>Ø¥ÙŠÙ‚Ø§Ù</button>
      </div>
    </div>

    <!-- ========== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: Ø§Ù„ØªØºØ°ÙŠØ© ========== -->
    <div id="nutritionTab" class="tab-content hidden">
      <div class="section">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h2>
        <div class="input-group">
          <label>Ø§Ù„ÙˆØ¬Ø¨Ø©</label>
          <select id="mealType">
            <option value="breakfast">ÙØ·ÙˆØ±</option>
            <option value="lunch">ØºØ¯Ø§Ø¡</option>
            <option value="dinner">Ø¹Ø´Ø§Ø¡</option>
            <option value="snack">ÙˆØ¬Ø¨Ø© Ø®ÙÙŠÙØ©</option>
          </select>
        </div>
        <div class="input-group">
          <label>Ø§Ø³Ù… Ø§Ù„Ø·Ø¹Ø§Ù…</label>
          <input type="text" id="foodItem" placeholder="Ù…Ø«Ù„: ØªÙØ§Ø­Ø©"/>
        </div>
        <div class="input-group">
          <label>Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</label>
          <input type="number" id="caloriesInput" placeholder="100" min="0"/>
        </div>
        <button id="saveMealBtn" class="btn" style="background:#3b82f6;">Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø©</button>
        <div id="mealsList" style="margin-top:20px;"></div>
      </div>
    </div>

    <!-- ========== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©: Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ========== -->
    <div id="profileTab" class="tab-content hidden">
      <div class="section">
        <h2>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        <div class="profile-info">
          <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> Ù…Ø³ØªØ®Ø¯Ù…</div>
          <div><strong>Ø§Ù„Ø¹Ù…Ø±:</strong> 25 Ø³Ù†Ø©</div>
          <div><strong>Ø§Ù„ÙˆØ²Ù†:</strong> 70 ÙƒØº</div>
          <div><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù†</div>
        </div>
        <button class="btn" style="background:#64748b;" onclick="alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§')">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
      </div>
    </div>
  </div>

  <script>
    // === Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙ†Ù‚Ù„ ===
    document.querySelectorAll('.nav-icon').forEach(icon => {
      icon.addEventListener('click', () => {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¬Ù…ÙŠØ¹
        document.querySelectorAll('.nav-icon').forEach(i => i.classList.remove('active'));
        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±
        icon.classList.add('active');
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        const tabId = icon.getAttribute('data-tab');
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
        document.getElementById(tabId + 'Tab').classList.remove('hidden');
      });
    });

    // === Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† (Ù…Ø¯Ù…Ø¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬ÙŠÙ†) ===
    let isTracking = false;
    let totalDistance = 0;
    let stepCount = 0;
    let lastGpsPosition = null;
    let lastGpsTime = 0;
    let lastAccel = 0;
    let lastStepTime = 0;
    let isGpsAvailable = false;
    let gpsTimeout = 0;

    const STEP_THRESHOLD = 1.7;
    const MIN_STEP_INTERVAL = 400;
    const GPS_TIMEOUT_MS = 5000;
    const AVG_STEP_LENGTH = 0.75; // Ù…ØªØ±

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†
    const workoutDistanceEl = document.getElementById('workoutDistance');
    const workoutStepsEl = document.getElementById('workoutSteps');
    const workoutLatEl = document.getElementById('workoutLat');
    const workoutLngEl = document.getElementById('workoutLng');
    const modeEl = document.getElementById('mode');
    const startWorkoutBtn = document.getElementById('startWorkoutBtn');
    const stopWorkoutBtn = document.getElementById('stopWorkoutBtn');

    function handleMotion(event) {
      if (!isTracking) return;
      const acc = event.accelerationIncludingGravity;
      if (!acc) return;

      const now = Date.now();
      const accel = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
      const delta = Math.abs(accel - lastAccel);
      lastAccel = accel;

      if (delta > STEP_THRESHOLD && (now - lastStepTime) > MIN_STEP_INTERVAL) {
        stepCount++;
        workoutStepsEl.textContent = stepCount;
        totalDistance += AVG_STEP_LENGTH;
        updateWorkoutDistance();
        lastStepTime = now;

        if (!isGpsAvailable || (now - lastGpsTime) > GPS_TIMEOUT_MS) {
          modeEl.textContent = 'ğŸš¶ ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§Ø®ÙÙ„ (PDR)';
          modeEl.style.background = '#ffedd5';
          modeEl.style.color = '#ea580c';
        }
      }
    }

    function updateGps() {
      if (!isTracking) return;
      if (!navigator.geolocation) return;

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          const now = Date.now();
          workoutLatEl.textContent = `Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${latitude.toFixed(6)}`;
          workoutLngEl.textContent = `Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: ${longitude.toFixed(6)}`;
          lastGpsPosition = { lat: latitude, lng: longitude };
          lastGpsTime = now;
          isGpsAvailable = true;
          gpsTimeout = 0;
          modeEl.textContent = 'ğŸ›°ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ø®Ø§Ø±ÙØ¬ (GPS + PDR)';
          modeEl.style.background = '#dbeafe';
          modeEl.style.color = '#1d4ed8';
        },
        () => {
          isGpsAvailable = false;
          gpsTimeout += 2000;
        },
        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
      );
    }

    function updateWorkoutDistance() {
      workoutDistanceEl.textContent = totalDistance >= 1000 
        ? (totalDistance / 1000).toFixed(3) + ' ÙƒÙ…' 
        : totalDistance.toFixed(1) + ' Ù…';
      // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      document.getElementById('dashSteps').textContent = stepCount;
      document.getElementById('dashDistance').textContent = workoutDistanceEl.textContent;
      document.getElementById('dashCalories').textContent = Math.round(stepCount * 0.04); // ~0.04 Ø³Ø¹Ø±Ø©/Ø®Ø·ÙˆØ©
    }

    function startWorkout() {
      if (!navigator.geolocation) {
        alert('Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…');
        return;
      }
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission().then(permission => {
          if (permission === 'granted') initWorkout();
          else alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø³.');
        });
      } else {
        initWorkout();
      }
    }

    function initWorkout() {
      isTracking = true;
      totalDistance = 0;
      stepCount = 0;
      workoutDistanceEl.textContent = '0.00 Ù…';
      workoutStepsEl.textContent = '0';
      workoutLatEl.textContent = 'Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: â€”';
      workoutLngEl.textContent = 'Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: â€”';
      modeEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...';
      startWorkoutBtn.disabled = true;
      stopWorkoutBtn.disabled = false;
      window.addEventListener('devicemotion', handleMotion);
      updateGps();
      setInterval(updateGps, 2000);
    }

    function stopWorkout() {
      isTracking = false;
      window.removeEventListener('devicemotion', handleMotion);
      startWorkoutBtn.disabled = false;
      stopWorkoutBtn.disabled = true;
      // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      document.getElementById('dashConsumed').textContent = document.getElementById('mealsList').children.length * 150 || 0;
    }

    startWorkoutBtn.addEventListener('click', startWorkout);
    stopWorkoutBtn.addEventListener('click', stopWorkout);

    // === Ø§Ù„ØªØºØ°ÙŠØ© ===
    document.getElementById('saveMealBtn').addEventListener('click', () => {
      const food = document.getElementById('foodItem').value.trim();
      const calories = document.getElementById('caloriesInput').value;
      if (!food || !calories) {
        alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª');
        return;
      }
      const meal = document.getElementById('mealType').value;
      const mealsList = document.getElementById('mealsList');
      mealsList.innerHTML += `<div style="padding:8px; border-bottom:1px solid #eee;">${food} (${meal}) - ${calories} Ø³Ø¹Ø±Ø©</div>`;
      document.getElementById('foodItem').value = '';
      document.getElementById('caloriesInput').value = '';
      // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
      document.getElementById('dashConsumed').textContent = mealsList.children.length * 150;
    });
  </script>
</body>
</html>
