<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .container {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 30px;
      font-weight: 700;
    }
    .step-display {
      font-size: 6rem;
      font-weight: 800;
      margin: 20px 0;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .status {
      font-size: 1.1rem;
      margin-top: 15px;
      opacity: 0.9;
    }
    .info {
      margin-top: 30px;
      font-size: 0.95rem;
      line-height: 1.5;
      opacity: 0.85;
    }
    @media (max-width: 480px) {
      .step-display {
        font-size: 4.5rem;
      }
      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·ÙˆØ§Øª</h1>
    <div class="step-display" id="stepCount">0</div>
    <div class="status" id="status">ğŸš¶â€â™‚ï¸ Ø¬Ø§Ù‡Ø²... Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´ÙŠ!</div>
    <div class="info">
      âœ… ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ ÙÙ‚Ø·<br>
      âœ… Ù„Ø§ ÙŠØ­Ø³Ø¨ Ø§Ù„Ù‡Ø² Ø£Ùˆ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©<br>
      âœ… Ù„Ø§ ÙŠØ­ØªØ§Ø¬ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ GPS
    </div>
  </div>

  <script>
    let stepCount = 0;
    let lastPeakTime = 0;
    let accelerationHistory = [];
    const STEP_THRESHOLD = 1.8;      // Ø­Ø¯ Ø§Ù„ØªØ³Ø§Ø±Ø¹ (g)
    const MIN_STEP_INTERVAL = 300;   // Ø£Ù‚Ù„ ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø®Ø·ÙˆØªÙŠÙ† (Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
    const MAX_STEP_INTERVAL = 1500;  // Ø£ÙƒØ«Ø± ÙˆÙ‚Øª Ø¨ÙŠÙ† Ø®Ø·ÙˆØªÙŠÙ†
    const HISTORY_SIZE = 10;         // Ø¹Ø¯Ø¯ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª Ù„Ù„ØªØ­Ù„ÙŠÙ„

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    function updateDisplay() {
      document.getElementById('stepCount').innerText = stepCount;
      document.getElementById('status').innerText = `ğŸš¶â€â™‚ï¸ Ø§Ù„Ø®Ø·ÙˆØ§Øª: ${stepCount}`;
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±ÙƒØ©
    function handleMotion(event) {
      const accel = event.accelerationIncludingGravity;
      if (!accel) return;

      const currentAccel = Math.abs(accel.y || accel.z || 0);
      const now = Date.now();

      // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„
      accelerationHistory.push({ time: now, value: currentAccel });
      if (accelerationHistory.length > HISTORY_SIZE) {
        accelerationHistory.shift();
      }

      // Ù†Ø­ØªØ§Ø¬ 5 Ø¹ÙŠÙ†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„
      if (accelerationHistory.length < 5) return;

      // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†Ù…Ø·: Ù‡Ù„ Ù‡Ù†Ø§Ùƒ "Ù‚Ù…Ø©"ØŸ
      const recent = accelerationHistory.slice(-5);
      const mid = recent[2].value;
      const isPeak = (
        mid > recent[1].value &&
        mid > recent[3].value &&
        mid > STEP_THRESHOLD
      );

      if (isPeak && now - lastPeakTime > MIN_STEP_INTERVAL) {
        // ØªØ£ÙƒÙŠØ¯ ÙˆØ¬ÙˆØ¯ "ÙˆØ§Ø¯ÙŠ" Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Ù…Ø© (Ù„Ù…Ù†Ø¹ Ø§Ù„Ù‡Ø²)
        setTimeout(() => {
          const newAccel = Math.abs(window.lastAccel || 0);
          if (newAccel < mid - 0.5) {
            const stepTimeDelta = now - lastPeakTime;
            if (stepTimeDelta >= MIN_STEP_INTERVAL && stepTimeDelta <= MAX_STEP_INTERVAL) {
              stepCount++;
              lastPeakTime = now;
              updateDisplay();
            }
          }
        }, 100);
        window.lastAccel = currentAccel;
      }
    }

    // Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø°Ù† (iOS)
    function startTracking() {
      if (typeof DeviceMotionEvent !== 'undefined') {
        if (typeof DeviceMotionEvent.requestPermission === 'function') {
          // iOS 13+
          DeviceMotionEvent.requestPermission()
            .then(permission => {
              if (permission === 'granted') {
                window.addEventListener('devicemotion', handleMotion);
                document.getElementById('status').innerText = 'âœ… Ø¬Ø§Ù‡Ø²! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´ÙŠ...';
              } else {
                document.getElementById('status').innerText = 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø­Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª';
              }
            })
            .catch(console.error);
        } else {
          // Android Ùˆ ØºÙŠØ± iOS
          window.addEventListener('devicemotion', handleMotion);
          document.getElementById('status').innerText = 'âœ… Ø¬Ø§Ù‡Ø²! Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´ÙŠ...';
        }
      } else {
        document.getElementById('status').innerText = 'âš ï¸ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ø­Ø±ÙƒØ©';
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    window.addEventListener('load', () => {
      // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      setTimeout(startTracking, 1000);
    });
  </script>
</body>
</html>
